{% extends 'base.html.twig' %}

{% block title %}{{randonnee.nomRandonnee}}{% endblock %}

{% block body %}
<main>
    <div class='ficheActivite__title d-flex justify-content-between mt-5 mb-3'>
        <h1>{{randonnee.nomRandonnee}}</h1> 
    </div>  

        <section class='ficheActivite'>           

            <h2>Description</h2>
                <ul>
                    <li>Ville de départ: {{randonnee.villeRandonnee}}</li>                         
                    <li>Coordonnées du point de départ: {{randonnee.geopointRandonnee}}</li>                         
                </ul>

            <h2>Parcours</h2>
            
            <div id='map'></div>
            <div class='data-map' data-coordinates='{{randonnee.geometryRandonnee|json_encode}}'></div>

            <script>
                let map = L.map('map').setView([43.610769, 3.876716], 12);
                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                }).addTo(map);

                document.addEventListener('DOMContentLoaded', function() { 
                let jsDataMap = document.querySelector('.data-map');    
                let data = JSON.parse(jsDataMap.dataset.coordinates); 

                let newdata = "";
                for( var i = 0; i < data.length; i++ ){ 
                    if( !(data[i] == '\n' || data[i] == '\r') )
                newdata += data[i];
                }      
            
                
                // Charger le GeoJSON
                let geojson = L.geoJson(JSON.parse(newdata));
                // Boucler à travers tous les points de coordonnées
                geojson.eachLayer(function (layer) {
                let latlngs = layer.getLatLngs();
                // Boucler à travers tous les points de coordonnées dans chaque géométrie
                for (let i = 0; i < latlngs.length; i++) {
                    let latlng = latlngs[i];
                    // Inverser les coordonnées
                    latlng.reverse();
                }
                let polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);
                map.fitBounds(polyline.getBounds());
                });

                });             
                
            
            </script>
       

    </section>
    

</main>
{% endblock %}
